<div xmlns:th="http://www.thymeleaf.org" th:fragment="content">
    <!-- Th√™m HTMX script n·∫øu ch∆∞a c√≥ -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <div class="w-full max-w-lg mx-auto px-4">
        <h2 class="text-2xl font-bold text-gray-800 mb-8 text-center"
            th:text="${user.userId != null ? 'Ch·ªânh s·ª≠a ng∆∞·ªùi d√πng' : 'Th√™m ng∆∞·ªùi d√πng'}">Th√™m ng∆∞·ªùi d√πng</h2>

        <!-- Hi·ªÉn th·ªã th√¥ng b√°o l·ªói -->
        <div th:if="${error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
            <span th:text="${error}"></span>
        </div>

        <!-- Form s·ª≠ d·ª•ng hx-post ƒë·ªÉ submit AJAX -->
        <form id="userForm"
              th:object="${user}"
              method="post"
              th:hx-post="${user.userId != null ? '/admin/fragment/users/edit/' + user.userId : '/admin/fragment/users/create'}"
              hx-target="#section-content"
              hx-swap="innerHTML"
              class="bg-white p-6 rounded shadow">

            <!-- Hidden field ƒë·ªÉ l∆∞u userId khi edit -->
            <input type="hidden" th:field="*{userId}" th:if="${user.userId != null}"/>

            <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-1">T√™n ƒëƒÉng nh·∫≠p *</label>
                <input type="text"
                       th:field="*{username}"
                       class="border rounded px-3 py-2 w-full focus:outline-none focus:border-blue-500"
                       required
                       placeholder="T√™n ƒëƒÉng nh·∫≠p"/>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-1">Email *</label>
                <input type="email"
                       th:field="*{email}"
                       class="border rounded px-3 py-2 w-full focus:outline-none focus:border-blue-500"
                       required
                       placeholder="Email h·ª£p l·ªá"/>
            </div>

            <!-- Tr∆∞·ªùng password ch·ªâ hi·ªÉn th·ªã khi t·∫°o m·ªõi -->
            <div class="mb-4" th:if="${user.userId == null}">
                <label class="block text-gray-700 font-medium mb-1">M·∫≠t kh·∫©u *</label>
                <input type="password"
                       th:field="*{password}"
                       class="border rounded px-3 py-2 w-full focus:outline-none focus:border-blue-500"
                       required
                       placeholder="M·∫≠t kh·∫©u"/>
            </div>

            <!-- Th√¥ng b√°o v·ªÅ password khi edit -->
            <div class="mb-4" th:if="${user.userId != null}">
                <p class="text-sm text-gray-600 italic bg-yellow-50 border border-yellow-200 p-2 rounded">
                    üí° ƒê·ªÉ tr·ªëng m·∫≠t kh·∫©u n·∫øu kh√¥ng mu·ªën thay ƒë·ªïi
                </p>
                <label class="block text-gray-700 font-medium mb-1 mt-2">M·∫≠t kh·∫©u m·ªõi (t√πy ch·ªçn)</label>
                <input type="password"
                       name="newPassword"
                       class="border rounded px-3 py-2 w-full focus:outline-none focus:border-blue-500"
                       placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi n·∫øu mu·ªën thay ƒë·ªïi"/>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-1">H·ªç t√™n</label>
                <input type="text"
                       th:field="*{fullName}"
                       class="border rounded px-3 py-2 w-full focus:outline-none focus:border-blue-500"
                       placeholder="H·ªç v√† t√™n"/>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-1">S·ªë ƒëi·ªán tho·∫°i</label>
                <input type="text"
                       th:field="*{phone}"
                       class="border rounded px-3 py-2 w-full focus:outline-none focus:border-blue-500"
                       placeholder="S·ªë ƒëi·ªán tho·∫°i"/>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-1">ƒê·ªãa ch·ªâ</label>
                <textarea th:field="*{address}"
                          class="border rounded px-3 py-2 w-full focus:outline-none focus:border-blue-500"
                          rows="2"
                          placeholder="ƒê·ªãa ch·ªâ"></textarea>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-1">Avatar (URL)</label>
                <input type="text"
                       th:field="*{avatar}"
                       class="border rounded px-3 py-2 w-full focus:outline-none focus:border-blue-500"
                       placeholder="ƒê∆∞·ªùng d·∫´n ·∫£nh ƒë·∫°i di·ªán"/>
                <!-- Hi·ªÉn th·ªã preview avatar n·∫øu c√≥ -->
                <div th:if="${user.avatar != null and !user.avatar.isEmpty()}" class="mt-2">
                    <img th:src="@{${user.avatar}}" alt="Avatar Preview" class="w-16 h-16 rounded-full border object-cover"/>
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-1">Quy·ªÅn</label>
                <select th:field="*{role}"
                        class="border rounded px-3 py-2 w-full focus:outline-none focus:border-blue-500">
                    <option value="USER">User</option>
                    <option value="ADMIN">Admin</option>
                </select>
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 font-medium mb-1">Tr·∫°ng th√°i</label>
                <select th:field="*{status}"
                        class="border rounded px-3 py-2 w-full focus:outline-none focus:border-blue-500">
                    <option value="1">Ho·∫°t ƒë·ªông</option>
                    <option value="0">Kh√≥a</option>
                </select>
            </div>

            <div class="flex justify-between gap-4">
                <!-- N√∫t L∆∞u: type="submit" s·∫Ω k√≠ch ho·∫°t hx-post tr√™n form -->
                <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded transition-colors">
                    <span th:text="${user.userId != null ? 'C·∫≠p nh·∫≠t' : 'T·∫°o m·ªõi'}">L∆∞u</span>
                </button>

                <!-- N√∫t Quay l·∫°i: S·ª≠ d·ª•ng hx-get ƒë·ªÉ t·∫£i l·∫°i danh s√°ch ng∆∞·ªùi d√πng -->
                <button type="button"
                        hx-get="/admin/fragment/users" 
                        hx-target="#section-content" 
                        hx-swap="innerHTML"
                        class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded transition-colors">
                    Quay l·∫°i
                </button>

                <!-- N√∫t X√ìA ch·ªâ hi·ªán khi ƒëang ·ªü ch·∫ø ƒë·ªô S·ª¨A -->
                <button type="button"
                        th:if="${user.userId != null}"
                        th:hx-post="@{/admin/fragment/users/delete/{id}(id=${user.userId})}" 
                        hx-target="#section-content" 
                        hx-swap="innerHTML"
                        hx-confirm="B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y kh√¥ng?"
                        class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-6 rounded transition-colors">
                    X√≥a
                </button>
            </div>
        </form>
    </div>
</div>