<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragmentsHome/header :: head}">
    <title>Kết quả tìm kiếm</title>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <div th:replace="~{fragmentsHome/header :: header}"></div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Breadcrumb -->
        <nav class="text-sm breadcrumbs mb-6">
            <ul class="flex items-center space-x-2 text-gray-600">
                <li><a href="/" class="hover:text-blue-600">Trang chủ</a></li>
                <li><span class="text-gray-400">/</span></li>
                <li class="text-gray-900">Kết quả tìm kiếm</li>
            </ul>
        </nav>

        <!-- Search Header -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <h1 class="text-2xl font-bold text-gray-900 mb-4">
                Kết quả tìm kiếm
                <span th:if="${searchQuery}" class="text-blue-600">"<span th:text="${searchQuery}"></span>"</span>
            </h1>
            <p class="text-gray-600">
                Tìm thấy <span th:text="${products.size()}"></span> sản phẩm
            </p>
        </div>

        <div class="flex flex-col lg:flex-row gap-6">
            <!-- Filters Sidebar -->
            <div class="lg:w-1/4">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Bộ lọc</h3>
                    
                    <!-- Search Form -->
                    <form th:action="@{/search}" method="get" class="space-y-4">
                        <!-- Search Input -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tìm kiếm</label>
                            <input type="text" name="q" th:value="${searchQuery}" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Nhập từ khóa...">
                        </div>

                        <!-- Category Filter -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Danh mục</label>
                            <select name="categoryId" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Tất cả danh mục</option>
                                <option th:each="category : ${categories}" 
                                        th:value="${category.categoryId}" 
                                        th:text="${category.name}"
                                        th:selected="${category.categoryId == selectedCategory}">
                                </option>
                            </select>
                        </div>

                        <!-- Price Range -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Khoảng giá</label>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="number" name="minPrice" th:value="${minPrice}" 
                                       class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       placeholder="Từ">
                                <input type="number" name="maxPrice" th:value="${maxPrice}" 
                                       class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       placeholder="Đến">
                            </div>
                        </div>

                        <!-- Sort Options -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Sắp xếp theo</label>
                            <select name="sortBy" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2">
                                <option value="name" th:selected="${sortBy == 'name'}">Tên sản phẩm</option>
                                <option value="price" th:selected="${sortBy == 'price'}">Giá</option>
                                <option value="createdAt" th:selected="${sortBy == 'createdAt'}">Ngày tạo</option>
                            </select>
                            <select name="sortOrder" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="asc" th:selected="${sortOrder == 'asc'}">Tăng dần</option>
                                <option value="desc" th:selected="${sortOrder == 'desc'}">Giảm dần</option>
                            </select>
                        </div>

                        <!-- Apply Filters Button -->
                        <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200">
                            Áp dụng bộ lọc
                        </button>
                    </form>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="lg:w-3/4">
                <!-- No Results -->
                <div th:if="${products.empty()}" class="text-center py-12">
                    <div class="text-gray-400 mb-4">
                        <i class="fas fa-search text-6xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2">Không tìm thấy sản phẩm</h3>
                    <p class="text-gray-600 mb-6">Thử thay đổi từ khóa tìm kiếm hoặc bộ lọc</p>
                    <a href="/" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition duration-200">
                        Về trang chủ
                    </a>
                </div>

                <!-- Products Grid -->
                <div th:if="${!products.empty()}" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div th:each="product : ${products}" class="bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition duration-200">
                        <a th:href="@{/detail/product/{id}(id=${product.productId})}">
                            <img th:src="${product.imageUrl}" th:alt="${product.name}" 
                                 class="w-full h-48 object-cover">
                        </a>
                        <div class="p-4">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">
                                <a th:href="@{/detail/product/{id}(id=${product.productId})}" 
                                   th:text="${product.name}" 
                                   class="hover:text-blue-600 transition duration-200">
                                </a>
                            </h3>
                            <p class="text-gray-600 text-sm mb-3" th:text="${#strings.abbreviate(product.description, 100)}"></p>
                            <div class="flex items-center justify-between">
                                <span class="text-xl font-bold text-red-600" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></span>
                                <button th:onclick="'addToCart(' + ${product.productId} + ')'" 
                                        class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">
                                    <i class="fas fa-cart-plus mr-2"></i>Thêm vào giỏ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <div th:replace="~{fragmentsHome/footer :: footer}"></div>

    <!-- Cart Script -->
    <script th:replace="~{fragmentsHome/header :: cartScript}"></script>

    <script>
        function addToCart(productId) {
            fetch('/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    productId: productId,
                    quantity: 1
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Cập nhật số lượng sản phẩm trong giỏ hàng
                    document.getElementById('cartItemCount').textContent = data.cartItemCount;
                    
                    // Hiển thị thông báo thành công
                    alert('Đã thêm sản phẩm vào giỏ hàng!');
                } else {
                    alert('Có lỗi xảy ra: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Có lỗi xảy ra khi thêm vào giỏ hàng');
            });
        }
    </script>
</body>
</html> 